{% extends 'base_admin.html' %}
{% load crispy_forms_tags %}

{% block title %}Painel Administrativo - Central de Contratos{% endblock %}

{% block breadcrumb_items %}<li class="breadcrumb-item active">Painel Principal</li>{% endblock %}

{% block extra_css %}
<style>
/* ===============================================
   PAINEL ADMINISTRATIVO - CSS MODERNO
   =============================================== */

.admin-layout {
    min-height: 100vh;
    background: #f8f9fa;
}

.admin-sidebar {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    min-height: 100vh;
    position: fixed;
    width: 280px;
    z-index: 1000;
    box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
}

.admin-main {
    margin-left: 280px;
    padding: 2rem;
}

.admin-header {
    background: #fff;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    margin-bottom: 2rem;
    border-left: 4px solid #f4623a;
}

.admin-nav {
    padding: 2rem 0;
}

.admin-nav-header {
    color: #ecf0f1;
    padding: 0 1.5rem 1rem;
    font-size: 1.1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 1rem;
}

.admin-nav-item {
    display: block;
    color: #bdc3c7;
    text-decoration: none;
    padding: 1rem 1.5rem;
    transition: all 0.3s ease;
    border-left: 3px solid transparent;
}

.admin-nav-item:hover,
.admin-nav-item.active {
    background: rgba(52, 152, 219, 0.2);
    color: #3498db;
    border-left-color: #3498db;
    transform: translateX(5px);
}

.admin-nav-item i {
    width: 20px;
    margin-right: 0.75rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: #fff;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #f4623a, #e4552f);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: #fff;
    margin-bottom: 1rem;
}

.stat-icon.contracts {
    background: linear-gradient(135deg, #3498db, #2980b9);
}

.stat-icon.revenue {
    background: linear-gradient(135deg, #27ae60, #229954);
}

.stat-icon.pending {
    background: linear-gradient(135deg, #f39c12, #e67e22);
}

.stat-icon.paid {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #2c3e50;
    margin: 0;
}

.stat-label {
    color: #7f8c8d;
    font-size: 0.9rem;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.admin-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    margin-bottom: 2rem;
}

.admin-card-header {
    background: linear-gradient(135deg, #f4623a, #e4552f);
    color: #fff;
    padding: 1.5rem;
    border-bottom: none;
}

.admin-card-title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.admin-card-body {
    padding: 2rem;
}

.tab-nav {
    display: flex;
    background: #f8f9fa;
    border-radius: 8px;
    padding: 4px;
    margin-bottom: 2rem;
}

.tab-link {
    flex: 1;
    text-align: center;
    padding: 1rem;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: #6c757d;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;
}

.tab-link.active {
    background: #fff;
    color: #f4623a;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Responsividade */
@media (max-width: 992px) {
    .admin-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .admin-sidebar.open {
        transform: translateX(0);
    }
    
    .admin-main {
        margin-left: 0;
        padding: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
}

.mobile-menu-toggle {
    display: none;
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1001;
    background: #f4623a;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 0.75rem;
    font-size: 1.25rem;
}

@media (max-width: 992px) {
    .mobile-menu-toggle {
        display: block;
    }
}

/* Animações */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.stat-card,
.admin-card {
    animation: fadeInUp 0.6s ease-out;
}

.stat-card:nth-child(1) { animation-delay: 0.1s; }
.stat-card:nth-child(2) { animation-delay: 0.2s; }
.stat-card:nth-child(3) { animation-delay: 0.3s; }
.stat-card:nth-child(4) { animation-delay: 0.4s; }
</style>
{% endblock %}

{% block content %}
<div class="admin-layout">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div class="admin-sidebar" id="adminSidebar">
        <div class="admin-nav">
            <div class="admin-nav-header">
                <i class="fas fa-shield-alt me-2"></i>
                Painel Admin
            </div>
            
            <a href="#overview" class="admin-nav-item active" onclick="showTab('overview')">
                <i class="fas fa-chart-bar"></i>
                Visão Geral
            </a>
            
            <a href="#contracts" class="admin-nav-item" onclick="showTab('contracts')">
                <i class="fas fa-file-contract"></i>
                Gestão de Contratos
            </a>
            
            <a href="#contract-types" class="admin-nav-item" onclick="showTab('contract-types')">
                <i class="fas fa-cog"></i>
                Controle de Preços
            </a>
            
            <div class="admin-nav-header">Gerenciamento</div>
            
            <a href="{% url 'adminpanel:contract_types_crud' %}" class="admin-nav-item">
                <i class="fas fa-plus-circle"></i>
                Criar/Editar Contratos
            </a>
            
            <a href="{% url 'admin:core_faq_changelist' %}" class="admin-nav-item">
                <i class="fas fa-question-circle"></i>
                Gerenciar FAQs
            </a>
            
            <a href="{% url 'adminpanel:dashboard' %}" class="admin-nav-item">
                <i class="fas fa-chart-line"></i>
                Dashboard Antigo
            </a>
            
            <a href="{% url 'admin:index' %}" class="admin-nav-item">
                <i class="fas fa-tools"></i>
                Django Admin
            </a>
            
            <a href="{% url 'core:home' %}" class="admin-nav-item">
                <i class="fas fa-home"></i>
                Voltar ao Site
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="admin-main">
        <!-- Header -->
        <div class="admin-header">
            <h1 class="mb-2">
                <i class="fas fa-crown me-3 text-warning"></i>
                Painel Administrativo
            </h1>
            <p class="text-muted mb-0">Gerencie contratos, preços e configurações do sistema</p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-link active" onclick="showTab('overview')">
                <i class="fas fa-chart-bar me-2"></i>Visão Geral
            </button>
            <button class="tab-link" onclick="showTab('contracts')">
                <i class="fas fa-file-contract me-2"></i>Gestão de Contratos
            </button>
            <button class="tab-link" onclick="showTab('contract-types')">
                <i class="fas fa-cog me-2"></i>Controle de Preços
            </button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon contracts">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <h3 class="stat-number">{{ total_contracts }}</h3>
                    <p class="stat-label">Total de Contratos</p>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon paid">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 class="stat-number">{{ paid_contracts }}</h3>
                    <p class="stat-label">Contratos Pagos</p>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon pending">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3 class="stat-number">{{ pending_contracts }}</h3>
                    <p class="stat-label">Pendentes</p>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon revenue">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <h3 class="stat-number">R$ {{ total_revenue|floatformat:0 }}</h3>
                    <p class="stat-label">Receita Total</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="admin-card">
                <div class="admin-card-header">
                    <h4 class="admin-card-title">
                        <i class="fas fa-bolt me-2"></i>
                        Ações Rápidas
                    </h4>
                </div>
                <div class="admin-card-body">
                    <div class="row g-3">
                        <div class="col-md-6 col-lg-3">
                            <button class="btn btn-outline-primary w-100" onclick="showTab('contracts')">
                                <i class="fas fa-file-contract me-2"></i>
                                Ver Contratos
                            </button>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <button class="btn btn-outline-success w-100" onclick="showTab('contract-types')">
                                <i class="fas fa-edit me-2"></i>
                                Editar Preços
                            </button>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <a href="{% url 'contracts:catalog' %}" class="btn btn-outline-info w-100">
                                <i class="fas fa-eye me-2"></i>
                                Ver Catálogo
                            </a>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <a href="{% url 'admin:index' %}" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-tools me-2"></i>
                                Django Admin
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contracts Tab -->
        <div id="contracts" class="tab-content">
            <div class="admin-card">
                <div class="admin-card-header">
                    <h4 class="admin-card-title">
                        <i class="fas fa-file-contract me-2"></i>
                        Gestão de Contratos
                    </h4>
                </div>
                <div class="admin-card-body">
                    <p class="text-center text-muted py-4">
                        <i class="fas fa-spinner fa-2x mb-3 d-block"></i>
                        Carregando gestão de contratos...
                    </p>
                    <div class="text-center">
                        <a href="{% url 'adminpanel:contracts_management' %}" class="btn btn-primary">
                            <i class="fas fa-external-link-alt me-2"></i>
                            Abrir Gestão Completa
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contract Types Tab -->
        <div id="contract-types" class="tab-content">
            <div class="admin-card">
                <div class="admin-card-header">
                    <h4 class="admin-card-title">
                        <i class="fas fa-cog me-2"></i>
                        Controle de Preços
                    </h4>
                </div>
                <div class="admin-card-body">
                    <p class="text-center text-muted py-4">
                        <i class="fas fa-spinner fa-2x mb-3 d-block"></i>
                        Carregando controle de preços...
                    </p>
                    <div class="text-center">
                        <a href="{% url 'adminpanel:contract_types_management' %}" class="btn btn-success">
                            <i class="fas fa-external-link-alt me-2"></i>
                            Abrir Controle Completo
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Remove active from all tab links
    document.querySelectorAll('.tab-link, .admin-nav-item').forEach(link => {
        link.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(tabName).classList.add('active');
    
    // Add active to clicked link
    event.target.classList.add('active');
}

function toggleSidebar() {
    const sidebar = document.getElementById('adminSidebar');
    sidebar.classList.toggle('open');
}

// Auto-close sidebar on mobile when clicking outside
document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('adminSidebar');
    const toggle = document.querySelector('.mobile-menu-toggle');
    
    if (window.innerWidth <= 992) {
        if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
            sidebar.classList.remove('open');
        }
    }
});

// Update stats with animation
document.addEventListener('DOMContentLoaded', function() {
    const statNumbers = document.querySelectorAll('.stat-number');
    
    statNumbers.forEach(stat => {
        const finalValue = parseInt(stat.textContent.replace(/[^0-9]/g, ''));
        let currentValue = 0;
        const increment = finalValue / 50;
        
        const timer = setInterval(() => {
            currentValue += increment;
            if (currentValue >= finalValue) {
                stat.textContent = stat.textContent; // Keep original format
                clearInterval(timer);
            } else {
                if (stat.textContent.includes('R$')) {
                    stat.textContent = 'R$ ' + Math.floor(currentValue);
                } else {
                    stat.textContent = Math.floor(currentValue);
                }
            }
        }, 30);
    });
});
</script>
{% endblock %}
