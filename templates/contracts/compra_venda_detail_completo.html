{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhes do Contrato - Central de Contratos{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-file-contract me-2"></i>
                            Contrato de Compra e Venda de Imóvel
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- Proprietário -->
                        <div class="section mb-4">
                            <h5 class="text-primary border-bottom pb-2">Proprietário</h5>
                            <div class="row">
                                <div class="col-md-8">
                                    <p><strong>Nome:</strong> {{ contrato.proprietario_nome }}</p>
                                    <p><strong>Estado Civil:</strong> {{ contrato.get_proprietario_estado_civil_display }}</p>
                                    <p><strong>Nacionalidade:</strong> {{ contrato.proprietario_nacionalidade }}</p>
                                    <p><strong>Profissão:</strong> {{ contrato.proprietario_profissao }}</p>
                                </div>
                                <div class="col-md-4">
                                    <p><strong>RG:</strong> {{ contrato.proprietario_rg }}</p>
                                    <p><strong>CPF:</strong> {{ contrato.proprietario_cpf }}</p>
                                </div>
                            </div>
                            <p><strong>Endereço:</strong> {{ contrato.endereco_completo_proprietario }}</p>
                            
                            {% if contrato.proprietario_conjuge_nome %}
                            <div class="mt-3">
                                <h6>Cônjuge</h6>
                                <p><strong>Nome:</strong> {{ contrato.proprietario_conjuge_nome }}</p>
                                <p><strong>CPF:</strong> {{ contrato.proprietario_conjuge_cpf }}</p>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Comprador -->
                        <div class="section mb-4">
                            <h5 class="text-primary border-bottom pb-2">Comprador</h5>
                            <div class="row">
                                <div class="col-md-8">
                                    <p><strong>Nome:</strong> {{ contrato.comprador_nome }}</p>
                                    <p><strong>Estado Civil:</strong> {{ contrato.get_comprador_estado_civil_display }}</p>
                                    <p><strong>Nacionalidade:</strong> {{ contrato.comprador_nacionalidade }}</p>
                                    <p><strong>Profissão:</strong> {{ contrato.comprador_profissao }}</p>
                                </div>
                                <div class="col-md-4">
                                    <p><strong>RG:</strong> {{ contrato.comprador_rg }}</p>
                                    <p><strong>CPF:</strong> {{ contrato.comprador_cpf }}</p>
                                </div>
                            </div>
                            <p><strong>Endereço:</strong> {{ contrato.endereco_completo_comprador }}</p>
                            
                            {% if contrato.comprador_conjuge_nome %}
                            <div class="mt-3">
                                <h6>Cônjuge</h6>
                                <p><strong>Nome:</strong> {{ contrato.comprador_conjuge_nome }}</p>
                                <p><strong>CPF:</strong> {{ contrato.comprador_conjuge_cpf }}</p>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Imóvel -->
                        <div class="section mb-4">
                            <h5 class="text-primary border-bottom pb-2">Imóvel</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Tipo:</strong> {{ contrato.get_imovel_tipo_display }}</p>
                                    <p><strong>Endereço:</strong> {{ contrato.endereco_completo_imovel }}</p>
                                    <p><strong>Matrícula:</strong> {{ contrato.imovel_matricula }}</p>
                                    <p><strong>Cartório:</strong> {{ contrato.imovel_cartorio }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>IPTU:</strong> {{ contrato.imovel_iptu }}</p>
                                    <p><strong>Área Territorial:</strong> {{ contrato.imovel_area_territorial }} m²</p>
                                    {% if contrato.imovel_area_construida %}
                                    <p><strong>Área Construída:</strong> {{ contrato.imovel_area_construida }} m²</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Detalhes da Venda -->
                        <div class="section mb-4">
                            <h5 class="text-primary border-bottom pb-2">Detalhes da Venda</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Valor Total:</strong> R$ {{ contrato.valor_total|floatformat:2 }}</p>
                                    <p><strong>Valor por Extenso:</strong> {{ contrato.valor_extenso }}</p>
                                    <p><strong>Forma de Pagamento:</strong> {{ contrato.get_forma_pagamento_display }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Data de Pagamento:</strong> {{ contrato.data_pagamento|date:"d/m/Y" }}</p>
                                    <p><strong>Data de Entrega:</strong> {{ contrato.data_entrega|date:"d/m/Y" }}</p>
                                    {% if contrato.conta_bancaria %}
                                    <p><strong>Conta Bancária:</strong> {{ contrato.conta_bancaria }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            
                            {% if contrato.forma_pagamento == 'parcelado' and contrato.datas_parcelas %}
                            <div class="mt-3">
                                <h6>Parcelas</h6>
                                <p><strong>Quantidade:</strong> {{ contrato.quantidade_parcelas }}</p>
                                <p><strong>Datas:</strong></p>
                                <ul>
                                    {% for data in contrato.datas_parcelas %}
                                        <li>{{ data }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Status -->
                        <div class="section mb-4">
                            <h5 class="text-primary border-bottom pb-2">Status</h5>
                            <p><strong>Status Atual:</strong> 
                                <span class="badge bg-{% if contrato.status == 'finalizado' %}success{% elif contrato.status == 'assinado' %}primary{% else %}secondary{% endif %}">
                                    {{ contrato.get_status_display }}
                                </span>
                            </p>
                            <p><strong>Criado em:</strong> {{ contrato.created_at|date:"d/m/Y H:i" }}</p>
                            <p><strong>Última atualização:</strong> {{ contrato.updated_at|date:"d/m/Y H:i" }}</p>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="row g-2">
                            <div class="col-md-6">
                                <a href="{% url 'contracts:catalog' %}" class="btn btn-outline-secondary w-100">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    Voltar ao Catálogo
                                </a>
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-primary w-100" onclick="window.print()">
                                    <i class="fas fa-print me-2"></i>
                                    Imprimir Contrato
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
.section {
    padding: 1rem 0;
}

.border-bottom {
    border-bottom: 2px solid #f4623a !important;
}

@media print {
    .card-footer,
    .btn {
        display: none !important;
    }
    
    .card {
        border: none !important;
    }
}
</style>
{% endblock %}
